{% extends 'base.html' %}
{% load i18n %}
{% load sq_tags %}
{% load pagination_tags %}
{% load core_tags %}
{% load avatar_tags %}
{% load countries_tags %}
{% load thumbnail %}

{% block breadcrumbs %} 
    {{ block.super }}
    &raquo; Challenge
    &raquo; {% if userchallenge %}{{userchallenge}}{% else %}{{challenge}}{% endif %}
{% endblock %}

{% block title %}{{challenge}}{% endblock %}

{% block content_title %}{% include "_challenge_header.html" %}{% endblock %}

{% block progressbar %}
{% if userchallenge %}
<div id="progressbar-content" title="{{ userchallenge.percent_complete }}% complete">
{{ userchallenge.get_status_display }}
{% if userchallenge.status == 1 %}{{ userchallenge.started|timesince }} ago{% endif %}
{% if userchallenge.status == 2 %}{{ userchallenge.completed|timesince }} ago{% endif %}
{% if userchallenge.topic %}
&#183; Applies to your <a href="{% url topic-detail topic_id=userchallenge.topic.id %}">{{ userchallenge.topic }}</a> topic 
    {% if userchallenge.topic.network %}
        from <a href="{% url network-detail network_id=userchallenge.topic.network.id %}">{{ userchallenge.topic.network }}</a>
    {% endif %}
{% endif %}
</div>
<div id="progressbar-sq" title="Your concept SQ is {{ userchallenge.sq }}">{% sqchange userchallenge.previous_sq userchallenge.sq %}</div>
{% endif %}
{% endblock %}


{% block content_left %}

        <blockquote>{{ challenge.description }}</blockquote>

        {% if challenge.concepts %}
            <h5>Concepts Covered</h5>
            <div class="stackcontainer">
                {% for concept in challenge.concepts.all %}
                    <span class="stack"><a href="{% url concept-detail concept_id=concept.id %}" class="concept">{{ concept }}</a></span>
                {% endfor %}
            </div>
            <br style="clear:both;" />
        {% endif %}

        <h5>Get Started</h5>
           
           <div class="buttonbar">
            {% ifequal userchallenge.status 0 %}
                <span class="button"><a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="startlink">Start</a></span>
            {% else %}
                {% ifequal userchallenge.status 1 %}  
                <span class="button"><a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="continuelink">Continue</a></span>
                {% endifequal %}
            {% endifequal %}

            {% if userchallenge.challenge.total_resources > 0 %}
                <span class="button"><a href="{% url challenge-prepare challenge_id=userchallenge.challenge.id %}">Prepare</a></span><br />
            {% endif %}
            </div>


        <h5>Top 10 Members</h5>
        <table style="width:100%;">
        {% for userchallenge in topusers %}
            {% with userchallenge.user as user %}
            {% with user.get_profile as profile %}
               <tr class="{% cycle 'odd' 'even' %}"><td style="width:32px;">{% avatar user 32 %}</td>
               <td style="line-height:1.5em;"><a href="{% url user-profile user_id=user.id %}">{{ profile.fullname }}</a><br />
                    <small>
                        {% if profile.country %}<img src="{{ profile.country.iso|iso_flag }}"> <a href="http://maps.google.com/maps?q={{ profile.country|urlencode }}&amp;t=h" target="_blank">{{ profile.country }}</a> &#183; {% endif %}
                        <a href="{% url network-detail network_id=profile.network.id %}">{{ profile.network }}</a>
                    </small></td>
               <td>{% sq userchallenge.sq %}&nbsp;{% sqdescriptive userchallenge.sq %}</td></tr>
            {% endwith %}
            {% endwith %}
        {% endfor %}
        </table>
 
    <h5>Top 10 Networks</h5>
    <table style="width:100%;">
    {% for network in topnetworks %}
       <tr class="{% cycle 'odd' 'even' %}"><td style="width:32px;"><img src="{% thumbnail network.image 32x32 crop %}"></td>
       <td style="line-height:1.5em;"><a href="{% url network-detail network_id=network.id %}">{{ network }}</a><br />
       {% if network.country %}<img src="{{ network.country.iso|iso_flag }}"> <a href="http://maps.google.com/maps?q={{ network.country|urlencode }}&amp;t=h" target="_blank">{{ network.country }}</a> &#183; {% endif %}
       {{ network.total_members }} member{{ network.total_members|pluralize }}
       </td>
       <td>{% sqchange 100 network.ncsq %}&nbsp;{% sqdescriptive network.ncsq %}</td></tr>
    {% endfor %}
    </table>
    
    <h5>Top 10 Countries</h5>
    <table style="width:100%;">
    {% for country in topcountries %}
       <tr class="{% cycle 'odd' 'even' %}"><td style="width:16px;"><img src="{{ country.iso|iso_flag }}"></span></td>
       <td style="line-height:1.5em;"><a href="http://maps.google.com/maps?q={{ country|urlencode }}&amp;t=h" target="_blank">{{ country }}</a></td>
       <td>{% sq country.sq %}&nbsp;{% sqdescriptive country.sq %}</td></tr>
    {% endfor %}
    </table>
 
{% endblock %}

{% block content_right %}

    {% include "_wall.html" %}
    
{% with challenge as obj %}{% include "_social.html" %}{% endwith %} 
{% endblock %} 
