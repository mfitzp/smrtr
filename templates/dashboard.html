{% extends "base.html" %}
{% load sq_tags %}
{% load i18n %}
{% load avatar_tags %}
{% load core_tags %}

    {% block content_left %}

    <div id="dashboard">

    <!-- <h5>Current Focus [ <span style="background-color:#eee">CHALLENGE</a> | STUDY ]</h5> -->

    {% if userchallengesexist %}
        <table>
        {% for userchallenge in userchallenges %}
        
            {% if forloop.first %}
            <tr id="focus"><td colspan="10">
            <div style="position:relative">
            <h5>{{ userchallenge }}</h5>
            <div style="position:absolute;top:10px;right:10px;font-weight:bold;font-size:1.8em;">{% sqchange 100 userchallenge.challenge.sq %}</div>
            <blockquote>{{ userchallenge.challenge.description }}</blockquote>
            <table>
            <tr><th>Available</th><td>{{ userchallenge.challenge.created|timesince }}</td></tr>
            <tr><th>Difficulty</th><td>{% sqdifficulty userchallenge.sq userchallenge.challenge.sq %}</td></tr>
            <tr><th>Challengers</th><td><span class="users">{{ userchallenge.challenge.userchallenge_set.count }} member{{ userchallenge.challenge.userchallenge_set.count|pluralize }}</span></td></tr>
            <tr><th>Duration</th><td>{% duration userchallenge.challenge.time_to_complete %}</td></tr>
            </table>
            <p style="text-align:right">
                    <span class="button">
                    {% ifequal userchallenge.status 0 %}
                    <a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="startlink">Start</a>
                    {% else %}
                        {% ifequal userchallenge.status 1 %}                    
                            <a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="continuelink">Continue</a>                        
                        {% endifequal %}
                    {% endifequal %}
                    </span>
            </p>
            </div>
            </td></tr>

            {% else %}

                <tr class="{% cycle 'odd' 'even' %}">
                    <td style="vertical-align:middle"><div class="progress" style="width:{% widthratio userconcept.focus 5 50 %}px;"></div></td>
                    <td class="dbcurriculumconcept challengestatus{{ userchallenge.status }}"><a href="{% url challenge-detail challenge_id=userchallenge.challenge.id %}">{{ userchallenge }}</a></td>
                    <td><span class="users">{{ userchallenge.challenge.userchallenge_set.count }}</span></td>
                    <td>{% sqdifficulty userchallenge.sq userchallenge.challenge.sq %}</td>
                    <td>{{ userchallenge.last_access|timesince }}</td>
                    <td>    
                        {% ifequal userchallenge.status 0 %}
                        <a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="startlink">Start</a>
                        {% else %}
                            {% ifequal userchallenge.status 1 %}                    
                                <a href="{% url challenge-do challenge_id=userchallenge.challenge.id %}" class="continuelink">Continue</a>           
                            {% endifequal %}
                        {% endifequal %}
                    </td>
                </tr>
                
            {% endif %}
            
        {% empty %}
        
            <tr id="focus"><td colspan="10">
            <div style="position:relative">
            <h5>Challenge Complete!</h5>
            <p>Congratulations, you've completed your assigned challenges for today!</p>
            <p><a href="{{ SMRTR_FREE_TIME_URL }}" target="_blank">Have a well-earned rest</a>, <a href="">study</a> or <a href="{% url challenge-generate %}">get some more?</a></p>
            </div>
            </td></tr>         
   
         
            
        {% endfor %}
        

       {% for userchallenge in userchallengescomplete %}
        
            <tr class="{% cycle 'odd' 'even' %}">
                <td style="vertical-align:middle"><div class="progress" style="width:{% widthratio userconcept.focus 5 50 %}px;"></div></td>
                <td class="dbcurriculumconcept challengestatus{{ userchallenge.status }}"><a href="{% url challenge-detail challenge_id=userchallenge.challenge.id %}">{{ userchallenge }}</a></td>
                    <td><span class="users">{{ userchallenge.challenge.userchallenge_set.count }}</span></td>
                <td style="text-align:right">{% sqchange 100 userchallenge.sq %} </td>
                <td>{{ userchallenge.last_access|timesince }}</td>
                <td></td>
            </tr>
            
        {% endfor %}        
    </table>
    <br style="clear:both;" /><p>
        <span class="button"><a href="" class="register">Show all available challenges &raquo;</a></span>
        <span class="button"> <a href="{% url challenge-create %}" class="register">Create custom challenge &raquo;</a></span>
    <p>

    {% else %}
    <table>
        <tr id="focus"><td colspan="10">
            <div style="position:relative">
            <h5>Welcome to Smrtr!</h5>
            <p>Once you're up and running, this box will show your current active challenges for today. To begin, just activate one of the modules
            below.</p>
            </div>
        </td></tr>
    </table>
    {% endif %}

       {% if usermodules %}
            <h5>Active Modules</h5>
            <div>
            {% for usermodule in usermodules %}
                <span class="stack"><a href="{% url module-detail module_id=usermodule.module.id %}" class="module">{{ usermodule }} ({% sqchange 100 usermodule.sq %})</a></span>
            {% endfor %}
            </div>
        {% endif %}

        <h5>Available Modules</h5>
        {% if suggestmodules %}
            <div>
            {% for suggestmodule in suggestmodules %}            <span class="stack"><a href="{% url module-detail module_id=suggestmodule.id %}" class="module">{{ suggestmodule }}</a></span>
            {% endfor %}
            </div>
    <!--        <p style="margin-top:1em;"><a href="" class="register">Show all available modules &raquo;</a><p> -->
        {% else %}
            <p><a href="{% url network-search %}">Join new networks</a> to find new study materials.</p>
        {% endif %}

    </div>

    {% endblock %}

    {% block content_right %}
    
        <h5>Notifications</h5>

        {% if notices %}
        <table style="width:100%">
        {% for notice in notices %}
        <tr class="{% cycle 'odd' 'even' %}"><td>{{ notice.message|safe }}</td>
            <td class="notice-meta">{{ notice.added|timesince }} ago</td></tr>
        {% endfor %}
        </table>      
        <p style="text-align:right;"><a href="{% url notification_notices %}">Show all notifications &raquo;</a></p>
        {% else %}
        <p>There are no notifications for you yet.</p>
        {% endif %}
        
        <h5>Discussions</h5>        
        
        {% include "_forum.html" %}  

        <h5>Networks</h5>
        {% if usernetworks %}
            <div>
            {% for usernetwork in usernetworks.all %}
                <span class="stack"><a href="{% url network-detail network_id=usernetwork.network.id %}" class="network network{{ usernetwork.network.type }}">{{ usernetwork }}</a></span>
            {% endfor %}
            </div>
        {% else %}
            <p>Join networks to learn with others at school, online or in your workplace.</p>
        {% endif %}
        <p style="margin-top:1em;"><span class="button"><a href="{% url network-search %}" class="register">Join new network &raquo;</a></span></p>


    {% endblock %}
